% EAJ - svg generation needs to be run with -shell-escape:
% pdflatex -shell-escape filename.tex
\documentclass[grado5]{LEMA-Tikz-IM}
\begin{document}
\begin{tikzpicture}
\usetikzlibrary{shapes,arrows,calc,fit,backgrounds,shapes.multipart}

\def\probSepHor{1.5}
\def\probSepVer{2}

% Problem boxes
\tikzstyle{problemType}=[
    rectangle split, 
    rectangle split parts=2, 
    rectangle split part fill={cyan!30, none}, 
    draw, 
    text width=5.5cm, 
    % minimum height=6cm,
    align=flush center
];
\node[problemType, anchor=south east] (probAboveLeft) at (-\probSepHor/2,\probSepVer/2) 
    {{\bfseries ¿Cuántos en cada grupo?}\nodepart{two}Han usa 6 bloques para formar 2 torres iguales. ¿Cuántos bloques hay en cada torre?
    % Han uses 6 blocks to make 2 equal stacks. \\How many blocks are in each stack?
    };
\node[problemType, anchor=south west] (probAboveRight) at (\probSepHor/2,\probSepVer/2) 
    {{\bfseries ¿Cuántos grupos?}\nodepart{two}Kiran usa 6 bloques para formar torres de 2 bloques cada una. \\¿Cuántas torres hay?
    % Kiran uses 6 blocks to make stacks. Each stack has 2 blocks. \\How many stacks are there?
    };
\node[problemType, anchor=north east] (probBelowLeft) at (-\probSepHor/2,-\probSepVer/2) 
    {{\bfseries ¿Cuántos grupos?}\nodepart{two}Jada usa 6 bloques para formar torres de 3 bloques cada una. \\¿Cuántas torres hay?
    % Jada uses 6 blocks to build stacks with 3 blocks each. \\How many stacks are there?
    };
\node[problemType, anchor=north west] (probBelowRight) at (\probSepHor/2,-\probSepVer/2) 
    {{\bfseries ¿Cuántos en cada grupo?}\nodepart{two}May usa 6 bloques para formar 3 torres iguales. ¿Cuántos bloques hay en cada torre?
    % May uses 6 blocks to make 3 equal stacks. \\How many blocks are in each stack?
    };

% Division expressions
\node[outer sep=10pt] (expresionTop) at (0,6.0) {$6\div2$};
\node[outer sep=10pt] (expresionBottom) at (0,-6.0) {$6\div3$};

% Diagrams of equal-sized groups
\tikzstyle{diagramBlock}=[fill=orange!70, line width=1pt];
\node[anchor=east] (diagramLeft) at (-7.0,0) {
    \begin{tikzpicture}[scale=0.5]
        \draw[diagramBlock] (0,0) rectangle (1,1);
        \draw[diagramBlock] (0,1) rectangle (1,2);
        \draw[diagramBlock] (0,2) rectangle (1,3);

        \draw[diagramBlock] (1.5,0) rectangle (2.5,1);
        \draw[diagramBlock] (1.5,1) rectangle (2.5,2);
        \draw[diagramBlock] (1.5,2) rectangle (2.5,3);
    \end{tikzpicture}
};

\node[anchor=west, minimum width=2cm] (diagramRight) at (7.0,0) {
    \begin{tikzpicture}[scale=0.5]
        \draw[diagramBlock] (0,0) rectangle (1,1);
        \draw[diagramBlock] (0,1) rectangle (1,2);

        \draw[diagramBlock] (1.5,0) rectangle (2.5,1);
        \draw[diagramBlock] (1.5,1) rectangle (2.5,2);

        \draw[diagramBlock] (3,0) rectangle (4,1);
        \draw[diagramBlock] (3,1) rectangle (4,2);
    \end{tikzpicture}
};

% Arrows
\tikzstyle{myarrowstyle}=[->, >=stealth, line width=1pt];
\draw[myarrowstyle] (probAboveLeft) |- (expresionTop);
\draw[myarrowstyle] (probAboveRight) |- (expresionTop);
\draw[myarrowstyle] (probBelowLeft) |- (expresionBottom);
\draw[myarrowstyle] (probBelowRight) |- (expresionBottom);

\draw[myarrowstyle] (probAboveLeft) -| (diagramLeft);
\draw[myarrowstyle] (probAboveRight) -| (diagramRight);
\draw[myarrowstyle] (probBelowLeft) -| (diagramLeft);
\draw[myarrowstyle] (probBelowRight) -| (diagramRight);

\end{tikzpicture}
\end{document}